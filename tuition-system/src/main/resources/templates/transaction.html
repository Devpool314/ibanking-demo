<!-- transaction.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Thanh toán - OTP</title>
</head>
<body>
  <h3>Thanh toán (test)</h3>

  Email: <input id="email" type="email"><br>
  TransactionId: <input id="transactionId" type="text"><br>
  <button id="send">Xác nhận giao dịch (gửi OTP)</button>

  <div id="otpDiv" style="display:none;">
    OTP: <input id="otp" type="text" maxlength="6">
    <button id="verify">Xác nhận lần cuối</button>
  </div>

  <div id="msg"></div>

  <script>
    document.getElementById('send').onclick = async () => {
      const email = document.getElementById('email').value;
      const transactionId = document.getElementById('transactionId').value;
      const res = await fetch('/api/otp/send', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({email, transactionId})
      });
      const txt = await res.text();
      document.getElementById('msg').innerText = txt;
      if (res.ok) document.getElementById('otpDiv').style.display = 'block';
    };

    document.getElementById('verify').onclick = async () => {
      const email = document.getElementById('email').value;
      const transactionId = document.getElementById('transactionId').value;
      const otp = document.getElementById('otp').value;
      const res = await fetch('/api/otp/verify', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({email, transactionId, otp})
      });
      const txt = await res.text();
      document.getElementById('msg').innerText = txt;
      if (res.ok) {
        setTimeout(()=> window.location.href = '/payment/success', 1500);
      }
    };
  </script>
</body>
</html>
